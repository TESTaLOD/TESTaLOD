<html>
<head>
        <meta name="viewport" content="width=device-width">
        <title>TESTaLOD</title>
        <!--Bootstrap-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"/>
        <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/file-uploader/5.16.2/all.fine-uploader/fine-uploader-new.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/file-uploader/5.16.2/all.fine-uploader/all.fine-uploader.js"></script>
        <style>

        .btnnot{
          Cursor:text !important; Text-Decoration: None !important; 
          pointer-events: none !important;

        }
        .loader {
          margin: auto;
          border: 16px solid #f3f3f3;
          border-radius: 50%;
          border-top: 16px solid #3498db;
          width: 150px;
          height: 150px;
          -webkit-animation: spin 1s linear infinite; /* Safari */
          animation: spin 1s linear infinite;
        }

        /* Safari */
        @-webkit-keyframes spin {
          0% { -webkit-transform: rotate(0deg); }
          100% { -webkit-transform: rotate(360deg); }
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
        .custom-control-label::before, 
        .custom-control-label::after {
        top: .1rem;
        width: 1.25rem;
        height: 1.25rem;
        }

        .liststep2 ul {
          list-style-type: none;
        }
        .github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}
          
        .text-label {
          font-size: 80%;
          font-weight: 400;
          color: #6c757d!important;
        }

        table table{
          border: 3px solid white;
          border-radius: 1em;

        }


        </style>


</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark" style="padding: 1rem">
        <h1 class="navbar-brand">
          TESTaLOD
        </h1>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                            <a class="nav-link" href="/">
                            COMPETENCY QUESTIONS
                            </a>
                    </li>
                    <li class="nav-item">
                            <a class="nav-link" href="/consistency">
                            CONSISTENCY CHECK (<span class="text-danger">BETA</span>)
                            </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/documentation">
                        DOCUMENTATION
                        </a>
                </li>
              </ul>
          </div>
    </nav>

            <a href="https://github.com/TESTaLOD/TESTaLOD" class="github-corner" aria-label="View source on GitHub" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

    <div class="container-fluid" style="padding: 0px;">
        <div class ="row" style="width: 100%; margin: 0px;">
            <div class="col-md-1"> </div>
            <div class="col-md-10 bg-secondary text-white" style="padding:15px; margin-top: 15px; margin-bottom: 15px; border-radius: .25rem;"> 
                TestaLOD is a tool supporting knowledge graph testing.<br>
                It supports the automatisation of unit tests backward execution.<br>
                Unit tests are usually modelled as competency questions e.g. in the eXtreme Design methodology<br>
                <div style="margin-top:15px"> Please refer to <b><a class="text-light" href="{{ url_for('static', filename='article/testalo_wop.pdf') }}"><u>this article</u></a></b> for details.</div></div>
               <!--- <div style="margin-top:15px"> Please refer to <b><a class="text-light" href="http://stlab.istc.cnr.it/documents/ufes-nemo-visit/ontology-testing.pdf"><u>this article</u></a></b> for details.</div></div>-->
            <div class="col-md-1"> </div>
          </div>
    <div class ="row" style="width: 100%; margin: 0px; min-height: 100% ">
        <div class="col-md-2">
        </div>
        <div class="col-md-8">
                <div class="accordion" id="accordionExample">



                    <!-- FIRST STEP -->
                        <div class="card">
                          <div class="card-header" id="headingOne">
                            <h5 class="mb-0">
                                {% if active=="1" %}
                                 <button class="btn  btnnot btn-link" id="step1btn" type="button"  data-target="#step1" aria-expanded="true" aria-controls="collapseOne">
                                    STEP #1 - Source Selection
                                  </button>
                                
                                {% else %}
                                 <button class="btn  btnnot btn-link" id="step1btn" type="button"  data-target="#step1" aria-expanded="true" aria-controls="collapseOne" disabled>
                                    STEP #1 - Source Selection
                                  </button>
                                
                                {% endif %}
                              
                            </h5>
                          </div>
                          <div id="step1" class="collapse {% if active=='1' %}show{%endif %}" aria-labelledby="headingOne" data-parent="#accordionExample">
                            <div class="card-body">
                                <div class="text-label" style="margin-bottom:35px">
                                    Choose the test cases you want to run (they must be <b>owl files</b>). <br>
                                    You can load them from a Github folder or browse them individually from a local path.</div>
                                    <form action="/" method="POST" enctype=multipart/form-data>
                                        <div class="form-group">
                                            <div class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" class="custom-control-input" id="customRadio" name="input-path" value="url" checked>
                                                <label class="custom-control-label" for="customRadio">CQ GITHUB FOLDER URL</label>
                                              </div>
                                              <div class="custom-control custom-radio custom-control-inline">
                                                <input type="radio" class="custom-control-input" id="customRadio2" name="input-path" value="local">
                                                <label class="custom-control-label" for="customRadio2">CQ LOCAL FILES</label>
                                              </div>
                                              <div id="holder">
                                                  <input type="text" class="form-control" id="urlinput" name="url" value="https://github.com/TESTaLOD/TESTaLOD/tree/master/testcase/CQ" required>
                                                  <small id="emailHelp" class="form-text text-muted">Load files from a Github folder (github folder url required)</small>
                                              </div>
                                            <div id="keywordlabelholder">
                                            <div class="custom-control custom-checkbox" style="margin-top:20px">
                                              <input type="checkbox" class="custom-control-input" id="keytrue" name="keytrue"  onchange="keycheck(this)">
                                              <label class="custom-control-label" for="keytrue">CQ FILTER</label>
                                            </div>
                                            <div id="keyword-holder"> </div>
                                          <small id="emailHelp" class="form-text text-muted">Filter Github folder's files by filename (i.e. "testcase" will retrive files having "testcase" in their name)</small>
                                          <div class="custom-control custom-checkbox" style="margin-top:20px">
                                              <input class="custom-control-input" type="checkbox" name="subfo" id="subfo" value="subfo" checked> 
                                              <label class="custom-control-label"  for="subfo">Load subfolders recursively</label>
                                            </div>
                                        </div>
                                        </div>
                                        <div id="buttonholder">
                                        <button id="fire1" type="submit" class="btn btn-primary">GO!</button>
                                      </div>
                                      </form>
                            </div>
                          </div>
                        </div>




                {% if local==False %}
                <!-- SECOND STEP -->
                        <div class="card" id="step2">
                          <div class="card-header" id="headingTwo">
                            <h5 class="mb-0">
                                {% if active=="2" %}
                                 <button class="btn  btnnot btn-link" id="step2btn" type="button"  data-target="#step2" aria-expanded="true" aria-controls="collapseTwo">
                                    STEP #2 - Files Selection
                                  </button>
                                
                                {% else %}
                                 <button class="btn  btnnot btn-link" id="step2btn" type="button"  data-target="#step2" aria-expanded="true" aria-controls="collapseTwo" disabled>
                                    STEP #2 - Files Selection
                                  </button>
                                
                                {% endif %}
                            </h5>
                          </div>
                          <div id="step2" class="collapse {% if active=='2' %}show{%endif %}"  aria-labelledby="headingTwo" data-parent="#accordionExample">
                            <div class="card-body">
                                    <div style ="padding: 5px">
                                        <div align="right">
                                            <a href="{{ url_for('index') }}"><button class="btn btn-secondary" type="button">GO BACK TO STEP #1</button></a>
                                            </div>

                                                     
                                                    <div class="card-title">
                                                        {% if data %}
                                                            <h3> <span id="counter"></span> Selected File<span id="plural">s</span></h3>
                                                            <div class="text-label">Select the files you want to test</div>
                                                            <div class="form-group">
                                                            <div class="custom-control custom-checkbox" style="margin-top:20px">
                                                              <input class="custom-control-input" type="checkbox" name="sel" id="selall" value="selall" checked onclick="ccchange(this)"> 
                                                              <label class="custom-control-label"  for="selall">SELECT ALL</label>
                                                            </div>
                                                            </div>
                                                            {% endif %}
                                                    <form id="files" action= "/test"  method="POST">
                                                        <!-- <div class="card-title">
                                                            
                                                            <button id="fire2" type="submit" data-toggle="modal" data-target="#load" class="btn btn-primary" data-backdrop="static" data-keyboard="false">TEST!</button>
                                                    </div> -->

                                                  {% if data %}
                                          {% macro listing(input, newkey) %}
                                            {% for key,value in input.items() if value is not none %}
                                            <details open class="liststep2">
                                              {% if newkey  %}
                                              <summary style="display: inline-block"><b>{{ key.split('master', 1)[1]|replace(newkey.split('master', 1)[1], "") }}</b>
                                              {% elif "master" in key %}
                                              <summary style="display: inline-block"><b>{{ key.split('master', 1)[1] }}</b>
                                              {% else %}
                                              <summary style="display: inline-block"><b>{{ key }}</b>
                                                {% endif %}
                                              
                                              </summary>
                                            <ul>
                                            {% for item in input[key] recursive %}
                                            {% if item is mapping %}
                                            {{ listing(item, key) }}
                                            {% else %}
                                            <li>
                                            <div class="custom-control custom-checkbox" style="margin-bottom: 10px">
                                                <input class="custom-control-input" type="checkbox" name="test" checked value= {{ item }} id= {{ item }} required>
                                                <label class="custom-control-label"  for= {{ item }}>
                                                    {% set keyrep = key|string %}
                                                    <a href= {{ item }} target="_blank"> {{ item.split('master', 1)[1]|replace(key.split('master')[1], "", 1) }}</a>  </label>
                                              </div>
                                            </li>
                                            {% endif %}
                                            {% endfor %}
                                            </ul>
                                            </details>
                                            {% endfor %}
                                            {% endmacro %}
                                            {{ listing(data, None) }}
                                           <div class="card-title">
                                              <button id="fire2bis" type="submit" data-toggle="modal" data-target="#load" class="btn btn-primary" data-backdrop="static" data-keyboard="false">TEST!</button>
                                            </div>
                                            {% endif %}
                                            </form>   
                                            </div>

            
                                    </div>
                            </div>
                          </div>
                        </div>
                        {% endif %}



                <!-- THIRD STEP -->
                        <div class="card">
                          <div class="card-header" id="headingThree">
                            <h5 class="mb-0">
                                {% if active=="3" %}
                                 <button class="btn  btnnot btn-link" id="step3btn" type="button"  data-target="#step3" aria-expanded="true" aria-controls="collapseThree">
                                    RESULTS
                                  </button>
                                
                                {% else %}
                                 <button class="btn  btnnot btn-link" id="step3btn" type="button"  data-target="#step3" aria-expanded="true" aria-controls="collapseThree" disabled>
                                    RESULTS
                                  </button>
                                
                                {% endif %}
                            </h5>
                          </div>
                          <div id="step3" class="collapse {% if active=='3' %}show{%endif %}" aria-labelledby="headingThree" data-parent="#accordionExample">
                            <div class="card-body">
                                <div class="card-title" align="right">
                                <a href="{{ url_for('index') }}"><button class="btn btn-secondary" type="button">RESTART</button></a>
 
                                {% if result and stats %}
                                <div class="row bg-light" style="padding-top: 20px; padding-bottom: 20px; margin-top: 10px; border-radius: .25rem;" align="center">
                                  <div class="col-3"><h3>Test{% if stats[0]+stats[1]+stats[2] !=1 %}s{% endif %} Executed: {{ stats[0]+stats[1]+stats[2] }}</h3></div>
                                  <div class="col-2"><i class="fas fa-check-circle fa-2x text-success"></i> <h3 style= "display: inline">{{ stats[0] }}</h3><br><small>All Expected Results Matched</small></div>
                                  <div class="col-2"><i class="fas fa-question-circle fa-2x text-warning"></i> <h3 style= "display: inline">{{ stats[1] }}</h3><br><small>Some Expected Results Matched</small></div>
                                  <div class="col-2"><i class="fas fa-times-circle fa-2x text-danger"></i> <h3  style= "display: inline"> {{ stats[2] }}</h3><br><small>No Expected Results Matched</small></div>
                                  <div class="col-3">
                                        <h3>{{ stats[3] }}″</h3>
                                  </div>
                                </div>
                                {% endif %}
                                </div>
                                {% if result %}
                                <ul>
                                {% for dicti in result %}
                                      <li class="border-bottom" style="list-style-type: none; margin-bottom:10px">
                                          {% if dicti["status"] == "errorinput" %}
                                          <div class="bg-danger text-light" style="padding-left: 3px; padding-right: 3px; border-radius: .25rem;">
                                              <i style= "display: inline-block" class="fas fa-exclamation-triangle fa-lg text-light"></i>
                                              <h5 style= "display: inline-block">Wrong Input at: </h3>
                                              {% if local==False %}
                                              <a style= "display: inline-block" target="_blank" class="text-light" href= {{ dicti["input"] }}>{{ dicti["input"].split('master', 1)[1] }}</a>
                                              <a style= "float: right; margin-top: 5px" href= {{ dicti["input"]|replace('master', 'blob/master', 1)|replace('raw.githubusercontent.com', 'github.com', 1) }} target="_blank">
                                                <i class="fab fa-github fa-lg text-light"></i>
                                              </a>
                                            {% elif local==True %}
                                            <p class="text-light">{{ dicti["input"] }}</p>
                                            {% endif %}
                                            </div>
                                        </li>
                                        {% else %}
                                          {% if dicti["status"] == True and not dicti["missingnumber"] %}
                                          <i class="fas fa-check-circle text-success fa-lg"></i> 
                                          {% elif dicti["status"] == False %}
                                          <i class="fas fa-times-circle text-danger fa-lg"></i> 
                                          {% elif dicti["status"] == True and dicti["missingnumber"] %}
                                          <i class="fas fa-question-circle text-warning fa-lg"></i> 
                                          {% endif %}
                                          {% if local == False %}
                                        <a href= {{ dicti["input"][0] }} target="_blank"> {{ dicti["input"][0].split('master', 1)[1] }}</a>    
                                        {% else %}
                                        <a> {{ dicti["input"][0]|replace("temp\\", "", 1) }}</a>
                                        {% endif %}
                                        {% if local == False %}
                                        <a style="margin-left:5px; margin-right:3px; float: right;" href= {{ dicti["input"][0]|replace('master', 'blob/master', 1)|replace('raw.githubusercontent.com', 'github.com', 1) }} target="_blank">
                                            <i class="fab fa-github fa-lg"></i>
                                        </a>
                                      {% endif %}
                                        <a data-toggle="modal" style="cursor:pointer; float: right;" data-target= {{ "#modal" + loop.index|string }}>
                                          <i class="fas fa-file-alt fa-lg"></i>
                                        </a>
                                        </li>
  


                                        <!-- Modal -->
                                      <div class="modal fade" id= {{ "modal" + loop.index|string }} tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                          <div class="modal-dialog" style= "max-width: 1000px !important" role="document">
                                            <div class="modal-content">
                                              <div class="modal-header">
                                                {% if local == False %}
                                                <h5 class="modal-title" id="exampleModalLabel">{{ dicti["input"][0].split('master', 1)[1] }}</h5>
                                                {% else %}
                                                <h5 class="modal-title" id="exampleModalLabel">{{ dicti["input"][0]|replace("temp\\", "", 1) }}</h5>
                                                {% endif %}
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                  <span aria-hidden="true">&times;</span>
                                                </button>
                                              </div>
                                              <div class="modal-body">
                                                
                                                    
                                                    <div style="margin: 20px">
                                                        {% if dicti["status"] == True and not dicti["missingnumber"] %}
                                                        <b class="alert alert-success">All Expected Results Matched</b>
                                                        {% elif dicti["status"] == False %}
                                                        <b class="alert alert-danger">No Expected Results Matched</b>
                                                        {% elif dicti["status"] == True and dicti["missingnumber"] %}
                                                        <b class="alert alert-warning">Missing {{ dicti["missingnumber"]|int }} Expected Result{% if dicti["missingnumber"]|int > 1 %}s{% endif %} </b>
                                                        {% endif %}
                                                    </div>
                                                    <ul style="padding-right:40px">
                                                        <li style="margin-bottom: 10px">
                                                            <b>HasCQ: </b>{{ dicti["input"][5] }}</a>
                                                        </li>
                                                        <li style="margin-bottom: 10px">
                                                            <b>HasInputTestDataCategory: </b>{{ dicti["input"][2] }}</a>
                                                        </li>
                                                        <li style="margin-bottom: 10px">
                                                          <b>HasInputTestDataUri: </b> <a href= {{ dicti["input"][3] }} target="_blank">{{ dicti["input"][3] }}</a>
                                                      </li>
                                                        <li style="margin-bottom: 10px">
                                                            <b>HasSPARQLQueryUnitTest:</b><pre class="alert bg-light"style="margin-left:40px; margin-top: 10px"><code>{{ dicti["input"][4] }}</code></pre>
                                                        </li>
                                                        <li style="margin-bottom: 10px">
                                                            <b>HasExpectedResult: </b>
                                                          <ul style="list-style-type: none;">
                                                            {% if dicti["status"] == True and not dicti["missingnumber"] %}
                                                                    {% for elem in dicti["matched"] %}
                                                                    <li class="alert alert-success">{{ elem.content |safe }}</li>
                                                                    {% endfor %}
                                                            {% elif dicti["status"] == False %}
                                                                    {% for elem in dicti["matched"] %}
                                                                    <li class="alert alert-danger">{{ elem.content |safe }}</li>
                                                                    {% endfor %}
                                                            {% elif dicti["status"] == True and dicti["missingnumber"] %}
                                                                    {% for elem in dicti["matched"] %}
                                                                            {% if elem.color == "Green" %}
                                                                                    <li class="alert alert-success">{{ elem.content |safe }}</li>
                                                                            {% elif elem.color == "Red" %}
                                                                                    <li class="alert alert-danger">{{ elem.content |safe }}</li>
                                                                            {% endif %}
                                                                    {% endfor %}
                                                            {% endif %}
                                                          </ul>
                                                        </li>                                       
                                                </ul>
                                              </div>
                                              <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                          </div>
                                        </div>
                                        {% endif %}
                                {% endfor %}
                              </ul>
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
            </div>
              <div class="col-md-2"></div>
            </div>


            <!--LOADING-->
            {% if active=="2" or active=="1" %}
            <div class="modal fade" id="load" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content" style="background: transparent !important; border: 0 !important">
                    <div class="loader"></div>
                  </div>
                </div>
              </div>
              {% endif %}




          <!--FOOTER-->
          <footer class="footer bg-dark text-white" style="margin-bottom: 0px; padding: 20px">
              <div class="container py-2" style="font-size: 80%">
                <div class="row"style="margin-bottom: 10px">
                  <div class="col-md-8" >
                      <div ><b>Authors:</b> Valentina Anita Carriero, Fabio Mariani, Andrea Giovanni Nuzzolese, Valentina Pasqual, Valentina Presutti</div>
                      <div><b>Main Developers:</b> Fabio Mariani, Valentina Pasqual</div>
                      <div style="margin-top: 30px">
                        <a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" style="color: grey" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
                      </div>
                    </div>
                  <div class="col-md-4" >
                    <img class="float-right" src="{{ url_for('static', filename='unibo.png') }}" width="32%">
                    <img class="float-right" src="{{ url_for('static', filename='cnr.png') }}" width="32%">
                    <img class="float-right" src="{{ url_for('static', filename='stlab.png') }}" width="32%"> 


                  </div>
              </div>
            </div>
          </footer>
        <script src="{{ url_for('static', filename='engine.js') }}"> </script>
        
</body>

</html>